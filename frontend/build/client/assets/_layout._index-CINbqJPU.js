import{o as e,t as E,a as l,w as I}from"./chunk-NL6KNZEE-DVU-DdLP.js";import{g as A}from"./sdk.gen-ZuoAz7BR.js";function v(t){if(t){if(typeof t=="string")return t;if(t["time.Time"])return t["time.Time"]}}const B=({fileInfo:t,isOpen:u,onClose:p})=>{if(!u||!t)return null;const g=i=>{if(!i)return"0 B";const h=["B","KB","MB","GB"];let o=i,m=0;for(;o>=1024&&m<h.length-1;)o/=1024,m++;return`${o.toFixed(1)} ${h[m]}`},x=i=>i?new Date(i).toLocaleString("ja-JP"):"-";return e.jsx("div",{className:"modal-overlay",onClick:p,children:e.jsxs("div",{className:"modal-content",onClick:i=>i.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:t.name}),e.jsx("button",{className:"close-button",onClick:p,children:"Ã—"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"label",children:"ç¨®é¡ž:"}),e.jsx("span",{className:"value",children:t.is_directory?"ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼":"ãƒ•ã‚¡ã‚¤ãƒ«"})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"label",children:"ã‚µã‚¤ã‚º:"}),e.jsx("span",{className:"value",children:g(t.size)})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"label",children:"ãƒ‘ã‚¹:"}),e.jsx("span",{className:"value",children:t.path})]}),e.jsxs("div",{className:"info-row",children:[e.jsx("span",{className:"label",children:"æ›´æ–°æ—¥æ™‚:"}),e.jsx("span",{className:"value",children:x(v(t.modified_time))})]})]})]})})},D=()=>{const t=E(),[u,p]=l.useState([]),[g,x]=l.useState(!1),[i,h]=l.useState(null),[o,m]=l.useState(""),[c,j]=l.useState(""),[b,w]=l.useState(null),[P,N]=l.useState(!1),y=s=>!s||s==="~/penguin"||s==="/home/shin/penguin"?"":s.startsWith("~/penguin/")?s.substring(10):s.startsWith("/home/shin/penguin/")?s.substring(19):s,C=s=>s?`~/penguin/${s}`:"~/penguin",d=l.useCallback(async s=>{const a=s||"",r=y(a);x(!0),h(null);try{console.log("Loading file entries for frontend path:",a),console.log("Converted to relative path:",r),console.log("Calling API with query:",r?{path:r}:{});const n=await A({query:r?{path:r}:{}});if(console.log("API response:",n),n.data){const f=n.data;console.log("Received data:",f),p(Array.isArray(f)?f:[]),m(a)}else if(n.error)throw console.error("API returned error:",n.error),new Error("APIã‚¨ãƒ©ãƒ¼: "+JSON.stringify(n.error))}catch(n){console.error("Error loading file entries:",n),h(n instanceof Error?n.message:"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ")}finally{x(!1)}},[t]);l.useEffect(()=>{d()},[d]);const S=s=>{if(s.is_directory){const a=C(y(s.path||""));j(a),d(a)}else w(s),N(!0)},F=s=>{s.preventDefault();const a="~/penguin";c.startsWith(a)||c===a||c===""?d(c):(j(a),d(a))},k=()=>{const s=o.split("/");if(s.length>1){const r=s.slice(0,-1).join("/")||"~/penguin",n="~/penguin";(r.startsWith(n)||r===n)&&(j(r),d(r))}},_=s=>{var r,n;if(s.is_directory)return"ðŸ“";switch((n=(r=s.name)==null?void 0:r.split(".").pop())==null?void 0:n.toLowerCase()){case"pdf":return"ðŸ“„";case"jpg":case"jpeg":case"png":case"gif":return"ðŸ–¼ï¸";case"mp4":case"avi":case"mov":return"ðŸŽ¬";case"mp3":case"wav":return"ðŸŽµ";default:return"ðŸ“„"}};return console.log("FileInfoGrid render:",{loading:g,error:i,fileInfosCount:u.length,pathInput:c,currentPath:o}),e.jsxs("div",{className:"folder-container",children:[e.jsx("div",{className:"header",children:e.jsxs("form",{onSubmit:F,className:"path-form",children:[e.jsx("button",{type:"button",onClick:k,className:"back-button",children:e.jsx("span",{className:"back-arrow",children:"â®œ"})}),e.jsx("input",{type:"text",value:c,onChange:s=>j(s.target.value),placeholder:"ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ãƒ‘ã‚¹ã‚’å…¥åŠ›",className:"path-input"}),e.jsx("button",{type:"submit",className:"load-button",children:"èª­ã¿è¾¼ã¿"})]})}),e.jsxs("div",{className:"folder-info",children:[e.jsxs("span",{className:"folder-count",children:[u.length," é …ç›®"]}),e.jsx("span",{className:"current-path",children:o||"~/penguin"})]}),g&&e.jsx("div",{className:"loading",children:"èª­ã¿è¾¼ã¿ä¸­..."}),i&&e.jsx("div",{className:"error",children:i}),e.jsx("div",{className:"folder-list",children:u.map((s,a)=>e.jsxs("div",{className:"folder-item",onClick:()=>S(s),children:[e.jsx("div",{className:"folder-icon",children:_(s)}),e.jsxs("div",{className:"folder-info",children:[e.jsx("div",{className:"folder-name",children:s.name}),e.jsxs("div",{className:"folder-meta",children:[e.jsx("span",{children:s.is_directory?"ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼":"ãƒ•ã‚¡ã‚¤ãƒ«"}),e.jsxs("span",{className:"folder-date",children:[" Â· æ›´æ–°: ",v(s.modified_time)?new Date(v(s.modified_time)).toLocaleDateString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"-"]})]})]})]},a))}),e.jsx(B,{fileInfo:b,isOpen:P,onClose:()=>N(!1)})]})},G=I(function(){return e.jsx(D,{})});export{G as default};
